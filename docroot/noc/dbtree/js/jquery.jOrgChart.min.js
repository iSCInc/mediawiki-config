(function(e){function t(n,r,i,s){var o=e("<table cellpadding='0' cellspacing='0' border='0'/>");var u=e("<tbody/>");var a=e("<tr/>").addClass("node-cells");var f=e("<td/>").addClass("node-cell").attr("colspan",2);var l=n.children("ul:first").children("li");var c;if(l.length>1){f.attr("colspan",l.length*2)}var h=n.clone().children("ul,li").remove().end().html();c=e("<div>").addClass("node").append(h);f.append(c);a.append(f);u.append(a);if(l.length>0){c.css("cursor","n-resize").addClass("expanded");if(s.depth==-1||i+1<s.depth){var p=e("<tr/>");var d=e("<td/>").attr("colspan",l.length*2);p.append(d);$downLine=e("<div></div>").addClass("line down");d.append($downLine);u.append(p);var v=e("<tr/>");l.each(function(){var t=e("<td>&nbsp;</td>").addClass("line left top");var n=e("<td>&nbsp;</td>").addClass("line right top");v.append(t).append(n)});v.find("td:first").removeClass("top").end().find("td:last").removeClass("top");u.append(v);var m=e("<tr/>");l.each(function(){var n=e("<td class='node-container'/>");n.attr("colspan",2);t(e(this),n,i+1,s);m.append(n)})}u.append(m)}if(n.attr("class")!=undefined){var g=n.attr("class").split(/\s+/);e.each(g,function(e,t){if(t=="collapsed"){a.nextAll("tr").css("display","none")}else{c.addClass(t)}})}o.append(u);r.append(o)}e.fn.jOrgChart=function(n){var r=e.extend({},e.fn.jOrgChart.defaults,n);var i=e(r.chartElement);$this=e(this);var s=e("<div class='"+r.chartClass+"'/>");if($this.is("ul")){t($this.find("li:first"),s,0,r)}else if($this.is("li")){t($this,s,0,r)}i.append(s);if(r.dragAndDrop){e("div.node").draggable({cursor:"move",distance:40,helper:"clone",opacity:.8,revert:true,revertDuration:100,snap:"div.node.expanded",snapMode:"inner",stack:"div.node"});e("div.node").droppable({accept:".node",activeClass:"drag-active",hoverClass:"drop-hover"});e("div.node").bind("dragstart",function(n,r){var i=e(this);i.parentsUntil(".node-container").find("*").filter(".node").droppable("disable")});e("div.node").bind("dragstop",function(n,i){e(r.chartElement).children().remove();$this.jOrgChart(r)});e("div.node").bind("drop",function(n,r){var i=r.draggable;var s=e(this);var o=e("li").filter(function(){li=e(this).clone().children("ul,li").remove().end();return li.html()==s.html()});var u=e("li").filter(function(){li=e(this).clone().children("ul,li").remove().end();return li.html()==i.html()});var a=u.clone();var f=u.parent("ul");if(f.children("li").size()>1){u.remove()}else{f.remove()}if(o.children("ul").size()>0){o.children("ul").append("<li>"+a.html()+"</li>")}else{o.append("<ul><li>"+a.html()+"</li></ul>")}})}};e.fn.jOrgChart.defaults={chartElement:"body",depth:-1,chartClass:"jOrgChart",dragAndDrop:false};})(jQuery)
